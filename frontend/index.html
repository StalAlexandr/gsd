<!DOCTYPE html>
<html>
<script src="/public/js/lib/angular.js"></script>
<script src="/public/js/controller.js"></script>
<link rel="stylesheet" href="public/css/main.css">

<body>
<div class="title">
    <span>Графическая система документооборота</span>
</div>
<div ng-init='init()' ng-app="myApp" ng-controller="myCtrl">
    <table>
        <tr>
            <td class="gsd" style="width: 500px">
              <svg ng-hide="network == null" width="100%" height="500">
                <defs>
                  <marker id="end-arrow"
                          viewBox="0 -5 10 10"
                          refX="47"
                          markerWidth="11"
                          markerHeight="11"
                          orient="auto">
                      <path d="M0,-5L10,0L0,5" stroke="black"></path>
                  </marker>
                </defs>
                </path>
                <!-- TODO maybe wrap in g element? -->
                <path ng-repeat-start="link in network.links"
                      ng-class="{link: true, selected: isLinkSelected(link)}"
                      ng-init="from=getNodeById(link.from);to=getNodeById(link.to);"
                      id="l{{from.id}}-{{to.id}}"
                      d="M{{from.x}},{{from.y}}L{{to.x}},{{to.y}}"
                      marker-end="url(#end-arrow)"
                      ng-click="selectOperation(link)">
                </path>
                <text ng-repeat-end
                      ng-click="selectOperation(link)"
                      ng-init="between=getPositionBetween(link);"
                      transform="translate({{between.x}},{{between.y}})">
                    {{link.label}}
                </text>
                <g ng-repeat="node in network.nodes"
                   ng-class="{node: true, selected: isNodeSelected(node)}"
                   id="{{node.id}}"
                   transform="translate({{node.x}},{{node.y}})"
                   ng-click="selectStatus(node)">
                    <circle class="shape" r="40"></circle>
                    <text text-anchor="middle"
                          ng-init="textParts=node.label.split(' ')"
                          transform="translate(0, {{ - (textParts.length + 1) * 10 + 7}})">
                      <tspan ng-repeat="textPart in textParts" x="0" dy="15">
                        {{textPart}}
                      </tspan>
                    </text>
                </g>

              </svg>
            </td>
            <td>
                <div id="info">
                    <table>
                        <tr>
                            <td>
                                <div class="appsearch">
                                    <br>
                                    <input placeholder="Выбор заявки" ng-model="selectedExtidappli" size="10">
                                        <button ng-click="getApplication()" ng-show="selectedExtidappli.length>0">OK</button>
                                    {{application.title}}
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="operation">
                                    <span class = "localtitle">Операция: {{selectedOperation.name}} </span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="documents">
                                    <span class = "localtitle">Документы: </span>
                                    <div ng-repeat="document in selectedOperation.documents">{{x}}
                                        <br><input type="checkbox" checked>  {{document.name}}
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="letters">
                                    <span class = "localtitle">Письма: </span>
                                    <div ng-repeat="letter in selectedOperation.letters">{{x}}
                                        <br><input type="checkbox" checked>  {{letter.name}}
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div>
                                <div class="controlpanel">
                                    <div class = "localtitle" class="controlpanel"><button>Провести оперцию!</button></div>
                                </div>
                            </td>
                        </tr>
                        </tr>
                    </table>
                </div>
            </td>

        </tr>
    </table>
</div>

</body>
</html>
